# Tutorial

## 1. Getting Started with Smart Contracts

### 1.1 -

nodeos -e -p eosio --delete-all-blocks --contracts-console

nodeos -e -p eosio --delete-all-blocks --plugin eosio::chain_api_plugin --plugin eosio::history_api_plugin

nodeos -e -p eosio --delete-all-blocks --plugin eosio::wallet_api_plugin --plugin eosio::chain_api_plugin --plugin eosio::history_api_plugin --contracts-console

### 1.2 -

--wallet-url=http://127.0.0.1:8889 wallet create

```{sh}
$ cleos --wallet-url=http://127.0.0.1:8889 wallet create

"/usr/local/eosio/bin/keosd" launched
Creating wallet: default
Save password to use in the future to unlock this wallet.
Without password imported keys will not be retrievable.
"PW5KLVGB3KT3MHD9NwsqgXFZUkrGEdzjrEfnU5ETq8TRHy5dXv3kz"
```

### 1.3 -

cleos wallet unlock --password PW5KLVGB3KT3MHD9NwsqgXFZUkrGEdzjrEfnU5ETq8TRHy5dXv3kz

### 1.4 -

cleos wallet import --private-key 5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3

### 1.5 - Load BIOS Contract

Now that we have a wallet with the key for the eosio account loaded, we can __set a default system contract__.

For the purposes of __development__, the __default eosio.bios__ contract can be used. This contract enables you to have direct control over the resource allocation of other accounts and to access other privileged API calls.

In a public blockchain, this contract will manage the staking and unstaking of tokens to reserve bandwidth for CPU and network activity, and memory for contracts.

The eosio.bios contract can be found in the `contracts/eosio.bios` folder of your `EOSIO` source code.

The command sequence below assumes it is being executed from the root of the EOSIO source, but you can execute it from anywhere by specifying the full path to `${EOSIO_SOURCE}/build/contracts/eosio.bios`.

```{bash}
$ cleos set contract eosio /Users/moraes/Documents/EOS_CLONE_AND_BUILD/eos/build/contracts/eosio.bios -p eosio@active

Reading WAST/WASM from EOS_CLONE_AND_BUILD/eos/build/contracts/eosio.bios/eosio.bios.wasm...
Using already assembled WASM...
Publishing contract...
executed transaction: c74512a2a359f6a59018ae1f3796e59fc5bbaa1118f542b8b7c19c86df768136  3720 bytes  720 us
#         eosio <= eosio::setcode               {"account":"eosio","vmtype":0,"vmversion":0,"code":"0061736d0100000001621260037f7e7f0060057f7e7e7e7e...
#         eosio <= eosio::setabi                {"account":"eosio","abi":"0e656f73696f3a3a6162692f312e30050c6163636f756e745f6e616d65046e616d650f7065...
```

### 1.6 - Create Accounts

Now that we have setup the basic system contract, we can start to create our own accounts. We will create two accounts, user and tester, and we will need to associate a key with each account. In this example, the same key will be used for both accounts.

To do this we first generate a key for the accounts.

```{bash}
$ cleos create

Private key: 5KjnEZzMtBvSVvXQ9T8xkqAHyFdPyrQ3jvkW1wBkUv9Bg3UVJjL
             5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3
Public key: EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV
            EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV
````

```{bash}
$ cleos wallet import --private-key 5KjnEZzMtBvSVvXQ9T8xkqAHyFdPyrQ3jvkW1wBkUv9Bg3UVJjL

# resposta
# $ cleos wallet import --private-key 5KjnEZzMtBvSVvXQ9T8xkqAHyFdPyrQ3jvkW1wBkUv9Bg3UVJjL
# imported private key for: EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV
```

-------

NOTE: Be sure to use the actual key value generated by the cleos command and not the one shown in the example above!

Keys are not automatically added to a wallet, so skipping this could result in losing control of your account.

Create Two User Accounts
Next we will create two accounts, user and tester, using the key we created and imported above.

```{bash}
$ cleos create account eosio user EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV

executed transaction: 8aedb926cc1ca31642ada8daf4350833c95cbe98b869230f44da76d70f6d6242  364 bytes  1000 cycles
#         eosio <= eosio::newaccount            {"creator":"eosio","name":"user","owner":{"threshold":1,"keys":[{"key":"EOS7GsbeN46LQ58nTudyzVXEFQEP...
```

```{bash}
$ cleos create account eosio tester EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV

executed transaction: 414cf0dc7740d22474992779b2416b0eabdbc91522c16521307dd682051af083 366 bytes  1000 cycles
#         eosio <= eosio::newaccount            {"creator":"eosio","name":"tester","owner":{"threshold":1,"keys":[{"key":"EOS7GsbeN46LQ58nTudyzVXEFQ...
```

-------

#### NOTE

The create account subcommand requires two keys, one for the OwnerKey (which in a production environment should be kept highly secure) and one for the ActiveKey. 

- In this tutorial example, the same key is used for both.

- __Because__ we are using the __eosio::history_api_plugin__ we can query all accounts that are controlled by our key:

```{bash}
$ cleos get accounts

Joses-iMac(moraes)$ cleos get accounts EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV
{
  "account_names": [
    "tester",
    "user"
  ]
}
```

-------

## 2 Introduction to the EOSIO Token Contract

mbmbmbmbmbmbmbmbmb

### 2.1 - Eosio.token, Exchange, and Eosio.msig Contracts

```{bash}
$ cleos create account eosio eosio.token \
        EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV \
        EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV

executed transaction: dbb4db12c7993bdfff60f005649c1fe2ab28b764ee34264814d654951f0e5762  200 bytes  214 us
#         eosio <= eosio::newaccount            {"creator":"eosio","name":"eosio.token","owner":{"threshold":1,"keys":[{"key":"EOS7GsbeN46LQ58nTudyz...
warning: transaction executed locally, but may not be confirmed by the network yet    ]
```

Then we can deploy the contract which can be found in ${EOSIO_SOURCE}/build/contracts/eosio.token

```{bash}
Unlocked: default
$ cleos wallet unlock --password PW5KLVGB3KT3MHD9NwsqgXFZUkrGEdzjrEfnU5ETq8TRHy5dXv3kz

$ cleos set contract eosio.token /Users/moraes/Documents/EOS_CLONE_AND_BUILD/eos/build/contracts/eosio.token -p eosio.token@active

Reading WAST/WASM from /Users/moraes/Documents/EOS_CLONE_AND_BUILD/eos/build/contracts/eosio.token/eosio.token.wasm...
Using already assembled WASM...
Publishing contract...
executed transaction: 3bb0fe51f78febfc6f1df81ea9063f46441231cfbaefc1e63cb4afbb64f969d0  8104 bytes  1286 us
#         eosio <= eosio::setcode               {"account":"eosio.token","vmtype":0,"vmversion":0,"code":"0061736d01000000017e1560037f7e7f0060057f7e...
#         eosio <= eosio::setabi                {"account":"eosio.token","abi":"0e656f73696f3a3a6162692f312e30010c6163636f756e745f6e616d65046e616d65...
warning: transaction executed locally, but may not be confirmed by the network yet    ]
```

### 2.2 Create the Currency Token

You can view the interface to eosio.token as defined by contracts/eosio.token/eosio.token.hpp:

```{C++}
void create( account_name issuer,
             asset maximum_supply );

void issue( account_name to, asset quantity, string memo );

void transfer( account_name from,
               account_name to,
               asset quantity,
               string memo );
```

To create a new token we must call the create(...) action with the proper arguments. This command will use the symbol of the maximum supply to uniquely identify this token from other tokens. The issuer will be the one with authority to call issue and or perform other actions such as freezing, recalling, and whitelisting of owners.

The concise way to call this method, using positional arguments:

```{bash}
$ cleos push action eosio.token create '[ "eosio", "1000000000.0000 SYS"]' -p eosio.token@active

executed transaction: b5385d63fe7ae6658492fc5f8d4d85c84eaef9440dd162ab1d3b37d1bfd5d9ab  120 bytes  11093 us
#   eosio.token <= eosio.token::create          {"issuer":"eosio","maximum_supply":"1000000000.0000 SYS"}
warning: transaction executed locally, but may not be confirmed by the network yet    ]
```

__Alternatively__, a more __verbose way__ to call this method, using named arguments:

```{bash}
$ cleos push action eosio.token create \
        '{"issuer":"eosio", "maximum_supply":"1000000000.0000 SYS"}' \
        -p eosio.token@active

executed transaction: 0e49a421f6e75f4c5e09dd738a02d3f51bd18a0cf31894f68d335cd70d9c0e12  120 bytes  1000 cycles
#   eosio.token <= eosio.token::create          {"issuer":"eosio","maximum_supply":"1000000000.0000 SYS"}
```

This command created a new token SYS with a precision of 4 decimals and a maximum supply of 1000000000.0000 SYS.

In order to create this token we required the permission of the eosio.token contract because it "owns" the symbol namespace (e.g. "SYS"). Future versions of this contract may allow other parties to buy symbol names automatically. For this reason we must pass -p eosio.token@active to authorize this call.

### 2.3 - Tokens to Account "User"

Now that we have created the token, the issuer can issue new tokens to the account user we created earlier. If you have not created an account named 'user', see the instructions here.

We will use the positional calling convention (vs named args).

```{bash}
$ cleos push action eosio.token issue '[ "user", "100.0000 SYS", "memo" ]' -p eosio@active

executed transaction: 822a607a9196112831ecc2dc14ffb1722634f1749f3ac18b73ffacd41160b019  268 bytes  1000 cycles
#   eosio.token <= eosio.token::issue           {"to":"user","quantity":"100.0000 SYS","memo":"memo"}
>> issue
#   eosio.token <= eosio.token::transfer        {"from":"eosio","to":"user","quantity":"100.0000 SYS","memo":"memo"}
>> transfer
#         eosio <= eosio.token::transfer        {"from":"eosio","to":"user","quantity":"100.0000 SYS","memo":"memo"}
#         user <= eosio.token::transfer        {"from":"eosio","to":"user","quantity":"100.0000 SYS","memo":"memo"}
```




```{bash}
cleos push action eosio.token issue '["user", "100.0000 SYS", "memo"]' -p eosio@active -d -j

{
  "expiration": "2018-08-02T23:45:04",
  "ref_block_num": 11754,
  "ref_block_prefix": 3458802853,
  "max_net_usage_words": 0,
  "max_cpu_usage_ms": 0,
  "delay_sec": 0,
  "context_free_actions": [],
  "actions": [{
      "account": "eosio.token",
      "name": "issue",
      "authorization": [{
          "actor": "eosio",
          "permission": "active"
        }
      ],
      "data": "00000000007015d640420f00000000000453595300000000046d656d6f"
    }
  ],
  "transaction_extensions": [],
  "signatures": [
    "SIG_K1_K2mWPDDcTQ7tKhau6E65SUJMkz3VvQfJ33kqGNTNJ3RNyWUpqAj3wX44aP3R2mLLYnpgSvXVXmQ8PHgHyc5SBrybMqWCGU"
  ],
  "context_free_data": []
}
```

### 2.4 - Transfer Tokens to Account "Tester"

Now that account user has tokens, we will transfer some to account tester. We indicate that user authorized this action using the permission argument -p user@active.

```{bash}
$ cleos wallet unlock --password PW5KLVGB3KT3MHD9NwsqgXFZUkrGEdzjrEfnU5ETq8TRHy5dXv3kz

$ cleos push action eosio.token transfer '[ "user", "tester", "25.0000 SYS", "m" ]' -p user@active

executed transaction: 06d0a99652c11637230d08a207520bf38066b8817ef7cafaab2f0344aafd7018  268 bytes  1000 cycles
#   eosio.token <= eosio.token::transfer        {"from":"user","to":"tester","quantity":"25.0000 SYS","memo":"m"}
>> transfer
#          user <= eosio.token::transfer        {"from":"user","to":"tester","quantity":"25.0000 SYS","memo":"m"}
#        tester <= eosio.token::transfer        {"from":"user","to":"tester","quantity":"25.0000 SYS","memo":"m"}
```

### 2.5 - Deploy Exchange Contract

Similar to the examples shown above, we can deploy the exchange contract. The exchange contract provides capabilities to create and trade currency. It is assumed this is being run from the root of the EOSIO source.

cleos create account eosio exchange  \
        EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV \
        EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV

cleos set contract exchange /Users/moraes/Documents/EOS_CLONE_AND_BUILD/eos/build/contracts/exchange -p exchange@active


The following steps can be used to deploy the eosio.msig contract.

$ cleos create account eosio eosio.msig  \
        EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV \
        EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV
#         eosio <= eosio::newaccount            {"creator":"eosio","name":"eosio.msig","owner":{"threshold":1,"keys":[{"key":"EOS7ijWCBmoXBi3CgtK7DJ...

$ cleos set contract eosio.msig /Users/moraes/Documents/EOS_CLONE_AND_BUILD/eos/build/contracts/eosio.msig -p eosio.msig@active
Reading WAST/WASM from build/contracts/eosio.msig/eosio.msig.wasm...
Using already assembled WASM...
Publishing contract...
executed transaction: 3433c434bdef42ba2150d5df46c17e0258f20b7836a057911faa2daa66262338  8864 bytes  1319 us
#         eosio <= eosio::setcode               {"account":"eosio.msig","vmtype":0,"vmversion":0,"code":"0061736d010000000198011760017f0060047f7e7e7...
#         eosio <= eosio::setabi                {"account":"eosio.msig","abi":"0e656f73696f3a3a6162692f312e30030c6163636f756e745f6e616d65046e616d650...



$ cleos create account eosio hello.code EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV
...
$ cleos set contract hello.code ../hello -p hello.code@active


RUM -----
cleos push action hello.code hi '["user"]' -p user@active
cleos push action hello.code hi '["user"]' -p tester@active

cleos push action hello.code hi '["tester"]' -p user@active
cleos push action hello.code hi '["tester"]' -p tester@active